{"version":3,"file":"ConnectAccount.js","sourceRoot":"","sources":["../../ts/components/ConnectAccount.tsx"],"names":[],"mappings":"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","sourcesContent":["import { useSignalEffect } from '@preact/signals'\nimport { makeError } from 'ethers'\nimport { useAsyncState } from '../library/preact-utilities.js'\nimport { EthereumAddress } from '../schema.js'\nimport { useEthereumProvider } from '../context/Ethereum.js'\nimport { useWallet } from '../context/Wallet.js'\nimport { useNotification } from '../context/Notification.js'\nimport { AsyncText } from './AsyncText.js'\nimport SVGBlockie from './SVGBlockie.js'\nimport { humanReadableEthersError, isJsonRpcError, isEthersError, humanReadableJsonRpcError } from '../library/errors.js'\n\nexport const ConnectAccount = () => {\n\tconst { browserProvider } = useEthereumProvider()\n\tconst { account } = useWallet()\n\tconst { value: query, waitFor } = useAsyncState<EthereumAddress>()\n\tconst { notify } = useNotification()\n\n\tconst connect = () => {\n\t\twaitFor(async () => {\n\t\t\tif (!browserProvider.value) {\n\t\t\t\tthrow makeError('No compatible web3 wallet detected.', 'UNKNOWN_ERROR', { error: { code: 4900 } })\n\t\t\t}\n\t\t\tconst signer = await browserProvider.value.getSigner()\n\t\t\treturn EthereumAddress.parse(signer.address)\n\t\t})\n\t}\n\n\tconst listenForQueryChanges = () => {\n\t\t// do not reset shared state for other instances of this hooks\n\t\tif (query.value.state === 'inactive') return\n\t\taccount.value = query.value\n\t}\n\n\tuseSignalEffect(listenForQueryChanges)\n\n\tswitch (account.value.state) {\n\t\tcase 'rejected':\n\t\t\tconst accountError = account.value.error\n\t\t\tif (isEthersError(accountError)) {\n\t\t\t\tlet message = humanReadableEthersError(accountError).message\n\t\t\t\tif (accountError.code === 'UNKNOWN_ERROR' && isJsonRpcError(accountError.error)) {\n\t\t\t\t\tmessage = humanReadableJsonRpcError(accountError.error).message\n\t\t\t\t}\n\t\t\t\tnotify({ message, title: 'Notice' })\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t<div class='grid grid-cols-[1fr,auto] gap-3 px-4 lg:px-0 h-20 border border-white/20 lg:border-none lg:place-items-end place-content-center items-center'>\n\t\t\t\t\t<div class='grid lg:place-items-end'>\n\t\t\t\t\t\t<span class='font-bold'>Get started quickly</span>\n\t\t\t\t\t\t<span class='text-sm text-white/50'>by connecting your wallet</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class='h-12 px-4 border border-white/50 bg-white/20' onClick={connect}>\n\t\t\t\t\t\tConnect\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t)\n\t\tcase 'inactive':\n\t\t\treturn (\n\t\t\t\t<div class='grid grid-cols-[1fr,auto] gap-3 px-4 lg:px-0 h-20 border border-white/20 lg:border-none lg:place-items-end place-content-center items-center'>\n\t\t\t\t\t<div class='grid lg:place-items-end'>\n\t\t\t\t\t\t<span class='font-bold'>Get started quickly</span>\n\t\t\t\t\t\t<span class='text-sm text-white/50'>by connecting your wallet</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class='h-12 px-4 border border-white/50 bg-white/20' onClick={connect}>\n\t\t\t\t\t\tConnect\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t)\n\t\tcase 'pending':\n\t\tcase 'resolved':\n\t\t\treturn (\n\t\t\t\t<div class='grid grid-cols-[1fr,auto] gap-2 px-4 lg:px-0 h-20 border border-white/20 lg:border-none place-items-end place-content-center items-center'>\n\t\t\t\t\t<div class='grid place-items-end'>\n\t\t\t\t\t\t<AccountAddress />\n\t\t\t\t\t\t<WalletNetwork />\n\t\t\t\t\t</div>\n\t\t\t\t\t<AccountAvatar />\n\t\t\t\t</div>\n\t\t\t)\n\t}\n}\n\nconst AccountAddress = () => {\n\tconst { account } = useWallet()\n\n\tswitch (account.value.state) {\n\t\tcase 'inactive':\n\t\t\treturn <></>\n\t\tcase 'rejected':\n\t\t\treturn <div class='whitespace-nowrap overflow-hidden overflow-ellipsis font-bold'>Not connected</div>\n\t\tcase 'pending':\n\t\t\treturn <AsyncText placeholderLength={40} />\n\t\tcase 'resolved':\n\t\t\treturn <div class='whitespace-nowrap overflow-hidden overflow-ellipsis font-bold'>{account.value.value}</div>\n\t}\n}\n\nconst NetworkIcon = () => (\n\t<svg width='1em' height='1em' viewBox='0 0 48 48' xmlns='http://www.w3.org/2000/svg'>\n\t\t<path fill='currentColor' d='M44 32h-2v-8a2 2 0 0 0-2-2H26v-6h2a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-8a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2v6H8a2 2 0 0 0-2 2v8H4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2h-2v-6h12v6h-2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2h-2v-6h12v6h-2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2Zm-34 8H6v-4h4ZM22 8h4v4h-4Zm4 32h-4v-4h4Zm16 0h-4v-4h4Z' data-name='icons Q2' />\n\t</svg>\n)\n\nconst AccountAvatar = () => {\n\tconst { account } = useWallet()\n\n\tswitch (account.value.state) {\n\t\tcase 'inactive':\n\t\tcase 'rejected':\n\t\t\treturn <div class='aspect-square w-10 outline-2 outline-white/20 bg-white/20' />\n\t\tcase 'pending':\n\t\t\treturn <div class='aspect-square w-10 outline outline-white/20 bg-white/20 animate-pulse' />\n\t\tcase 'resolved':\n\t\t\treturn (\n\t\t\t\t<div style={{ fontSize: '2.5em' }}>\n\t\t\t\t\t<SVGBlockie address={account.value.value} />\n\t\t\t\t</div>\n\t\t\t)\n\t}\n}\n\nconst WalletNetwork = () => {\n\tconst { account } = useWallet()\n\n\tswitch (account.value.state) {\n\t\tcase 'inactive':\n\t\tcase 'rejected':\n\t\t\treturn <></>\n\t\tcase 'pending':\n\t\t\treturn <AsyncText placeholderLength={16} />\n\t\tcase 'resolved':\n\t\t\treturn (\n\t\t\t\t<div class='inline-flex items-center justify-end gap-1 text-white/50 text-sm'>\n\t\t\t\t\t<NetworkIcon />\n\t\t\t\t\t<NetworkName />\n\t\t\t\t</div>\n\t\t\t)\n\t}\n}\n\nconst NetworkName = () => {\n\tconst { network } = useEthereumProvider()\n\n\tswitch (network.value.state) {\n\t\tcase 'inactive':\n\t\t\treturn <span class='capitalize leading-tight'>&nbsp;</span>\n\t\tcase 'pending':\n\t\t\treturn <AsyncText placeholderLength={8} />\n\t\tcase 'resolved':\n\t\t\treturn <span class='capitalize leading-tight'>{network.value.value.name}</span>\n\t\tcase 'rejected':\n\t\t\treturn <span class='capitalize leading-tight'>Unable to connect to wallet</span>\n\t}\n}\n"]}