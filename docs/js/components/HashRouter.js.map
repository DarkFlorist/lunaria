{"version":3,"file":"HashRouter.js","sourceRoot":"","sources":["../../ts/components/HashRouter.tsx"],"names":[],"mappings":"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","sourcesContent":["import { signal, useComputed } from '@preact/signals'\nimport { ComponentChildren, JSX } from 'preact'\nimport { useEffect } from 'preact/hooks'\n\ntype RouteProps = {\n\tpath: string\n\tchildren: ComponentChildren\n}\n\nexport const Route = ({ children }: RouteProps) => <>{children}</>\n\ntype RouterModel =\n\t| {\n\t\t\tactiveRoute: JSX.Element[] | JSX.Element\n\t\t\tparams: { [key: string]: string | undefined } | undefined\n\t  }\n\t| {\n\t\t\tactiveRoute: undefined\n\t\t\tparams: undefined\n\t  }\n\nconst router = signal<RouterModel>({ activeRoute: undefined, params: undefined })\n\nexport const Router = ({ children }: { children: unknown | unknown[] }) => {\n\tconst getValidChildren = () => {\n\t\tif (!Array.isArray(children)) {\n\t\t\trouter.value = { activeRoute: isRouteComponent(children) ? children : <></>, params: undefined }\n\t\t\treturn\n\t\t}\n\n\t\tconst routeChildrenOnly = children.filter(isRouteComponent)\n\t\tfor (const child of routeChildrenOnly) {\n\t\t\tconst pathMatch = matchPathToLocation(child.props.path, window.location.hash)\n\t\t\tif (pathMatch === undefined) continue\n\t\t\trouter.value = { activeRoute: child, params: pathMatch }\n\t\t}\n\t}\n\n\tuseEffect(() => {\n\t\tgetValidChildren()\n\t\twindow.addEventListener('hashchange', getValidChildren)\n\t\treturn () => window.removeEventListener('hashchange', getValidChildren)\n\t}, [])\n\n\treturn <>{router.value.activeRoute}</>\n}\n\nexport function useRouter<T extends Partial<{ [key: string]: string }>>() {\n\treturn useComputed(() => ({ activeRoute: router.value.activeRoute, params: router.value.params as T }))\n}\n\nconst stripLeadingSlash = (path: string) => {\n\treturn path.startsWith('/') ? path.slice(1) : path\n}\n\nfunction isRouteComponent(child: unknown): child is ReturnType<typeof Route> {\n\treturn child !== null && typeof child === 'object' && 'props' in child && child.props !== null && typeof child.props === 'object' && 'path' in child.props\n}\n\nexport function matchPathToLocation(pattern: string, location: string) {\n\tconst patternSegments: string[] = stripLeadingSlash(pattern).split('/')\n\tconst locationSegments: string[] = stripLeadingSlash(location).split('/')\n\n\tconst params: { [key: string]: string | undefined } = {}\n\n\tfor (const [index, patternSegment] of patternSegments.entries()) {\n\t\tconst locationSegment = locationSegments[index]\n\n\t\tif (patternSegment.startsWith(':')) {\n\t\t\tconst variableName = patternSegment.slice(1)\n\t\t\tparams[variableName] = locationSegment || undefined\n\t\t} else if (patternSegment !== locationSegment) {\n\t\t\treturn undefined\n\t\t}\n\t}\n\n\treturn params\n}\n"]}