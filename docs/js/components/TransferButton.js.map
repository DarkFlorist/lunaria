{"version":3,"file":"TransferButton.js","sourceRoot":"","sources":["../../ts/components/TransferButton.tsx"],"names":[],"mappings":"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","sourcesContent":["import { useComputed, useSignalEffect } from '@preact/signals'\nimport { JSX } from 'preact/jsx-runtime'\nimport { removeNonStringsAndTrim } from '../library/utilities.js'\nimport { useTransfer } from '../context/Transfer.js'\nimport * as Icon from './Icon/index.js'\nimport { useEthereumProvider } from '../context/Ethereum.js'\nimport { useAsyncState } from '../library/preact-utilities.js'\nimport { EthereumAddress } from '../schema.js'\nimport { useWallet } from '../context/Wallet.js'\nimport { makeError } from 'ethers'\n\nexport const TransferButton = () => {\n\tconst { transaction } = useTransfer()\n\n\tconst isTransferring = useComputed(() => transaction.value.state === 'pending')\n\n\tif (isTransferring.value)\n\t\treturn (\n\t\t\t<Button type='button' disabled>\n\t\t\t\t<Icon.Spinner />\n\t\t\t\t<span>Transfer in progress...</span>\n\t\t\t</Button>\n\t\t)\n\n\treturn <ConnectOrTransferButton />\n}\n\nconst ConnectOrTransferButton = () => {\n\tconst { value: query, waitFor } = useAsyncState<EthereumAddress>()\n\tconst { browserProvider } = useEthereumProvider()\n\tconst { account } = useWallet()\n\n\tconst connect = () => {\n\t\twaitFor(async () => {\n\t\t\tif (!browserProvider.value) {\n\t\t\t\tthrow makeError('No compatible web3 wallet detected.', 'UNKNOWN_ERROR', { error: { code: 4900 } })\n\t\t\t}\n\t\t\tconst signer = await browserProvider.value.getSigner()\n\t\t\treturn EthereumAddress.parse(signer.address)\n\t\t})\n\t}\n\n\tconst listenForQueryChanges = () => {\n\t\t// do not reset shared state for other instances of this hooks\n\t\tif (query.value.state === 'inactive') return\n\t\taccount.value = query.value\n\t}\n\n\tuseSignalEffect(listenForQueryChanges)\n\n\tswitch (account.value.state) {\n\t\tcase 'inactive':\n\t\tcase 'rejected':\n\t\t\treturn (\n\t\t\t\t<Button type='button' onClick={connect}>\n\t\t\t\t\t<ConnectIcon />\n\t\t\t\t\t<span>Connect Wallet</span>\n\t\t\t\t</Button>\n\t\t\t)\n\t\tcase 'pending':\n\t\t\treturn (\n\t\t\t\t<Button type='button' disabled>\n\t\t\t\t\t<Icon.Spinner />\n\t\t\t\t\t<span>Connecting wallet...</span>\n\t\t\t\t</Button>\n\t\t\t)\n\t\tcase 'resolved':\n\t\t\treturn (\n\t\t\t\t<Button type='submit'>\n\t\t\t\t\t<TransferIcon />\n\t\t\t\t\t<span>Start Transfer</span>\n\t\t\t\t</Button>\n\t\t\t)\n\t}\n}\n\nconst Button = ({ class: className, children, ...props }: JSX.HTMLAttributes<HTMLButtonElement>) => {\n\treturn (\n\t\t<button class={removeNonStringsAndTrim('outline-none border border-white/50 h-16 px-4 grid grid-flow-col items-center place-content-center gap-2 bg-white/10 font-semibold disabled:text-white/50 disabled:border-white/50 focus|hover:enabled:border-white focus|hover:enabled:bg-white/20', className)} {...props}>\n\t\t\t{children}\n\t\t</button>\n\t)\n}\n\nconst ConnectIcon = () => (\n\t<svg width='1em' height='1em' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>\n\t\t<path fill='none' stroke='currentColor' stroke-width='2' d='M10 21c-2.5 2.5-5 2-7 0s-2.5-4.5 0-7l3-3 7 7-3 3Zm4-18c2.5-2.5 5-2 7.001 0 2.001 2 2.499 4.5 0 7l-3 3L11 6l3-3Zm-3 7-2.5 2.5L11 10Zm3 3-2.5 2.5L14 13Z' />\n\t</svg>\n)\n\nconst TransferIcon = () => (\n\t<svg width='1em' height='1em' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>\n\t\t<g fill='none'>\n\t\t\t<path d='M24 0v24H0V0h24ZM12.593 23.258l-.011.002-.071.035-.02.004-.014-.004-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01-.017.428.005.02.01.013.104.074.015.004.012-.004.104-.074.012-.016.004-.017-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113-.013.002-.185.093-.01.01-.003.011.018.43.005.012.008.007.201.093c.012.004.023 0 .029-.008l.004-.014-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014-.034.614c0 .012.007.02.017.024l.015-.002.201-.093.01-.008.004-.011.017-.43-.003-.012-.01-.01-.184-.092Z' />\n\t\t\t<path d='M20 14a1.5 1.5 0 0 1 .144 2.993L20 17H7.621l1.44 1.44a1.5 1.5 0 0 1-2.008 2.224l-.114-.103-3.829-3.83c-.974-.974-.34-2.617.991-2.725l.14-.006H20ZM14.94 3.44a1.5 1.5 0 0 1 2.007-.104l.114.103 3.829 3.83c.974.974.34 2.617-.991 2.725l-.14.006H4a1.5 1.5 0 0 1-.144-2.993L4 7h12.379l-1.44-1.44a1.5 1.5 0 0 1 0-2.12Z' fill='currentColor' />\n\t\t</g>\n\t</svg>\n)\n"]}