!function(i,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((i||self).preactSignalsCore={})}(this,function(i){function t(){throw new Error("Cycle detected")}function o(){if(!(s>1)){var i,t=!1;while(void 0!==h){var o=h;h=void 0;r++;while(void 0!==o){var n=o.o;o.o=void 0;o.f&=-3;if(!(8&o.f)&&4&o.f&&u(o))try{o.c()}catch(o){if(!t){i=o;t=!0}}o=n}}r=0;s--;if(t)throw i}else s--}var n=void 0,h=void 0,s=0,r=0,f=0;function e(i){if(void 0!==n){var t=i.n;if(void 0===t||t.t!==n){n.s=t={f:0,i:0,S:i,p:void 0,n:n.s,t:n,e:void 0,x:void 0,r:t};i.n=t;if(32&n.f)i.S(t);return t}else if(1&t.f){t.f&=-2;var o=n.s;if(t!==o){var h=t.p,s=t.n;if(void 0!==h)h.n=s;if(void 0!==s)s.p=h;if(void 0!==o)o.p=t;t.p=void 0;t.n=o;n.s=t}return t}}}function v(i){this.v=i;this.i=0;this.n=void 0;this.t=void 0}v.prototype.h=function(){return!0};v.prototype.S=function(i){if(!(2&i.f)){i.f|=2;i.x=this.t;if(void 0!==this.t)this.t.e=i;this.t=i}};v.prototype.U=function(i){if(2&i.f){i.f&=-3;var t=i.e,o=i.x;if(void 0!==t){t.x=o;i.e=void 0}if(void 0!==o){o.e=t;i.x=void 0}if(i===this.t)this.t=o}};v.prototype.subscribe=function(i){var t=this;return _(function(){var o=t.value,n=32&this.f;this.f&=-33;try{i(o)}finally{this.f|=n}})};v.prototype.valueOf=function(){return this.value};v.prototype.toString=function(){return this.value+""};v.prototype.peek=function(){return this.v};Object.defineProperty(v.prototype,"value",{get:function(){var i=e(this);if(void 0!==i)i.i=this.i;return this.v},set:function(i){if(i!==this.v){if(r>100)t();this.v=i;this.i++;f++;s++;try{for(var n=this.t;void 0!==n;n=n.x)n.t.N()}finally{o()}}}});function u(i){var t=i.s;while(void 0!==t){if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)break;t=t.n}return void 0!==t}function d(i){for(var t=i.s;void 0!==t;t=t.n){var o=t.S.n;if(void 0!==o)t.r=o;t.S.n=t;t.f|=1}}function c(i){var t=i.s,o=void 0;while(void 0!==t){var n=t.n;if(1&t.f){t.S.U(t);t.n=void 0}else{if(void 0!==o)o.p=t;t.p=void 0;t.n=o;o=t}t.S.n=t.r;if(void 0!==t.r)t.r=void 0;t=n}i.s=o}function a(i){v.call(this,void 0);this.x=i;this.s=void 0;this.g=f-1;this.f=4}(a.prototype=new v).h=function(){this.f&=-3;if(1&this.f)return!1;if(32==(36&this.f))return!0;this.f&=-5;if(this.g===f)return!0;this.g=f;this.f|=1;if(this.i>0&&!u(this)){this.f&=-2;return!0}var i=n;try{d(this);n=this;var t=this.x();if(16&this.f||this.v!==t||0===this.i){this.v=t;this.f&=-17;this.i++}}catch(i){this.v=i;this.f|=16;this.i++}n=i;c(this);this.f&=-2;return!0};a.prototype.S=function(i){if(void 0===this.t){this.f|=36;for(var t=this.s;void 0!==t;t=t.n)t.S.S(t)}v.prototype.S.call(this,i)};a.prototype.U=function(i){v.prototype.U.call(this,i);if(void 0===this.t){this.f&=-33;for(var t=this.s;void 0!==t;t=t.n)t.S.U(t)}};a.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var i=this.t;void 0!==i;i=i.x)i.t.N()}};a.prototype.peek=function(){if(!this.h())t();if(16&this.f)throw this.v;return this.v};Object.defineProperty(a.prototype,"value",{get:function(){if(1&this.f)t();var i=e(this);this.h();if(void 0!==i)i.i=this.i;if(16&this.f)throw this.v;return this.v}});function l(i){var t=i.u;i.u=void 0;if("function"==typeof t){s++;var h=n;n=void 0;try{t()}catch(t){i.f&=-2;i.f|=8;y(i);throw t}finally{n=h;o()}}}function y(i){for(var t=i.s;void 0!==t;t=t.n)t.S.U(t);i.x=void 0;i.s=void 0;l(i)}function w(i){if(n!==this)throw new Error("Out-of-order effect");c(this);n=i;this.f&=-2;if(8&this.f)y(this);o()}function p(i){this.x=i;this.u=void 0;this.s=void 0;this.o=void 0;this.f=36}p.prototype.c=function(){var i=this.S();try{if(!(8&this.f)&&void 0!==this.x)this.u=this.x()}finally{i()}};p.prototype.S=function(){if(1&this.f)t();this.f|=1;this.f&=-9;l(this);d(this);s++;this.f&=-5;var i=n;n=this;return w.bind(this,i)};p.prototype.N=function(){if(!(2&this.f)){this.f|=6;this.o=h;h=this}};p.prototype.d=function(){this.f|=8;if(!(1&this.f))y(this)};function _(i){var t=new p(i);t.c();return t.d.bind(t)}i.Signal=v;i.batch=function(i){if(s>0)return i();s++;try{return i()}finally{o()}};i.computed=function(i){return new a(i)};i.effect=_;i.signal=function(i){return new v(i)}});//# sourceMappingURL=signals-core.min.js.map
